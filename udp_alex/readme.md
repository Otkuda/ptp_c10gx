# IP-ядра стека UDP/IP

## Описание

Модули поддерживают Ethernet со скоростями 1/10/25G. Включает модули для обработки посылок Ethernet, а также IP, UDP и ARP. Содержит модули для работы с PTP.
Для передачи данных между модулями используется AXI-Stream интерфейс. Исходные файлы для него в папке axis/rtl. Тесты для всех модулей находятся в папках tb.

## Тестирование

Тесты написаны с помощью фреймворков на языке программирования Python. Рекомендуемая версия Python 3.10.8 и новее.
Библиотеки для запуска тестов содержатся в requirements.txt. Для установки всех библиотек разом можно использовать команду:

Windows: `pip install -r requirements.txt`  
Linux:   `pip3 install -r requirements.txt`

### Запуск тестов

В папке udp/tb содержатся два вида тестов: с использованием библиотеки myhdl и с использованием библиотеки cocotb.

#### myhdl

Находятся не во вложенных папках и работают в парах имя_файла.v, имя_файла.py. Чтобы запустить

`python3 -m pytest имя_файла.py`

**Важно**

- Проверьте наличие файла `myhdl.vpi` в папке `tb`, без него тесты не запустятся. Если этого файла нет, инструкция по его получению:
[инструкция](https://gitlab.spbpu.com/customprojects/jinr/tss/tss-tx-rx/-/issues/3#note_46886).
- Эти тесты запускаются только под WSL или Linux.
- Должен быть установлен Icarus Verilog

Запустить все тесты сразу можно командой

`python3 run_all_tests.py myhdl`

Результаты о пройденных тестах появятся в файле `tests_res.txt`. Файл с временной диаграммой `имя_теста.lxt` открывается программой gtkwave.  
Формат данных в файле с результатами:

`имя_теста ./F/" " [100%]`

- . - тест пройден полностью
- F - тест провален
- " " - тест не пройден, завершился по timeout 2 минуты.

#### cocotb

Написаны не для всех модулей. Для каждого модуля содержится отдельная папка с тестом. Для запуска:

Linux: `make`
Windows: `python -m pytest имя_файла.py`

На Windows для получения файла с временной диаграммой можно в исходный файл модуля добавить блок ifdef с дампом .vcd файла, который открывается в gtkwave.
На Linux получение файла с временной диаграммой настраивается в файле Makefile для каждого теста. В Makefile есть переменная `WAVES` по умолчанию равная 0.
Если вручную поменять ее значение на 1, то после прохождения теста сгенерируется .fst файл, который открывается в gtkwave.
